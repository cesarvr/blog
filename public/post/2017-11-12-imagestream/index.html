<!DOCTYPE html>
<html lang="en">




<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
    Exporting external images to Openshift
     | Cesar 
  </title>
  <link rel="stylesheet" href='https://cesarvr.io/css/site.min.cc3fc5270f71da844cfcd512ac94081d2c969c9619b62a823c9279c7179b2d8fabd5b53456f25fa3c1586d19ce4255b5cb5f0dc927ee3b0b15d60065c50372fd.css' integrity='sha512-zD/FJw9x2oRM/NUSrJQIHSyWnJYZtiqCPJJ5xxebLY&#43;r1bU0VvJfo8FYbRnOQlW1y18NySfuOwsV1gBlxQNy/Q=='>
  <link rel="canonical" href="https://cesarvr.io/post/2017-11-12-imagestream/">
  <link rel="alternate" type="application/rss&#43;xml" href="https://cesarvr.io/index.xml" title="Happy Hacking">
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Cesar">
<meta name="description" content="Getting Started First you need to have an Openshift installation on the cloud or in your machine, the second option is the easiest one thanks to the oc cluster up command, this will create a small local installation of openshift in your machine, if your are not familiar take a quick look at the documentation.
Creating a project Once oc cluster up finish you should have an Openshift installation up and ready in your local machine, now next step is to login in and create a project.">

<meta property="og:title" content="Exporting external images to Openshift" />
<meta property="og:description" content="Getting Started First you need to have an Openshift installation on the cloud or in your machine, the second option is the easiest one thanks to the oc cluster up command, this will create a small local installation of openshift in your machine, if your are not familiar take a quick look at the documentation.
Creating a project Once oc cluster up finish you should have an Openshift installation up and ready in your local machine, now next step is to login in and create a project." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cesarvr.io/post/2017-11-12-imagestream/" />
<meta property="article:published_time" content="2017-11-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-09-03T14:44:47+01:00" />


</head>
<body><nav class="navbar is-transparent " role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://cesarvr.io/">
      <figure class="image">
        <img alt="" class="is-rounded" src="https://www.gravatar.com/avatar/a0c107b88dd0930e66b241a400e11bd2?s=128&d=identicon">
      </figure>
    </a>
    <a class="navbar-item" href="https://cesarvr.io/">
      Happy Hacking
    </a>
  </div>
  
  <div class="navbar-menu">
    <div class="navbar-start">
      
      <a class="navbar-item" href="https://cesarvr.io/tags/build/">
        
        Build
        
      </a>
      
      <a class="navbar-item" href="https://cesarvr.io/tags/containers/">
        
        Containers
        
      </a>
      
      <a class="navbar-item" href="https://cesarvr.io/tags/docker/">
        
        Docker
        
      </a>
      
      <a class="navbar-item" href="https://cesarvr.io/tags/openshift/">
        
        Openshift
        
      </a>
      
      <a class="navbar-item" href="https://cesarvr.io/tags/performance/">
        
        Performance
        
      </a>
      
      <a class="navbar-item" href="https://cesarvr.io/tags/programming/">
        
        Programming
        
      </a>
      
    </div>
    
    <div class="navbar-end">
      
      <a class="navbar-item" href="https://github.com/cesarvr" rel="noopener" target="_blank">
        <span class="icon">
          <img alt="github-circle" src='https://cesarvr.io/icons/svg/github-circle.svg'>
        </span>
      </a>
      
      <a class="navbar-item" href="https://www.linkedin.com/in/cesarvr/" rel="noopener" target="_blank">
        <span class="icon">
          <img alt="linkedin" src='https://cesarvr.io/icons/svg/linkedin.svg'>
        </span>
      </a>
      
      <a class="navbar-item" href="mailto:cesarv01@yahoo.com" target="_blank">
        <span class="icon">
          <img alt="email" src='https://cesarvr.io/icons/svg/email.svg'>
        </span>
      </a>
      <a class="navbar-item" href="https://cesarvr.io/index.xml" target="_blank">
        <span class="icon">
          <img alt="rss" src='https://cesarvr.io/icons/svg/rss.svg'>
        </span>
      </a>
      
    </div>
  </div>
</nav>
<section class="hero is-small is-info is-fullwidth">
  <div class="hero-body">
<div class="container">
  <h1 class="title">
    Exporting external images to Openshift
  </h1>
  <h2 class="subtitle">
    <time datetime='2017-11-12T00:00:00Z'>
      November 12, 2017
    </time>
    
  </h2>
</div>

  </div>
</section>
<section class="section">
  <div class="container">
<div class="content is-medium">
  

<h1 id="getting-started">Getting Started</h1>

<p>First you need to have an Openshift installation on the cloud or in your machine, the second option is the easiest one thanks to the <code>oc cluster up</code> command, this will create a small local installation of openshift in your machine, if your are not familiar take a quick look at the <a href="https://github.com/openshift/origin/blob/master/docs/cluster_up_down.md#getting-started">documentation</a>.</p>

<h1 id="creating-a-project">Creating a project</h1>

<p>Once <code>oc cluster up</code> finish you should have an Openshift installation up and ready in your local machine, now next step is to login in and create a project.</p>

<pre><code>oc login https://127.0.0.1:8443/  
oc new-project hello
</code></pre>

<p>The last command will create a project and will keep it as the one in use, so all commands will affect just hello project.</p>

<h1 id="exporting-your-image">Exporting your image</h1>

<p>To import an image you run <code>oc import-image</code> this command will create a new image stream object pointing the image you want to use.</p>

<pre><code>  oc import-image cvr-node:latest --from=docker.io/cvaldezr/nodejs --confirm
</code></pre>

<h1 id="using-the-image">Using the image</h1>

<p>After successfully importing the image now is time to use it, so to demonstrate this let create a simple Pod object, with  a Node.js application.</p>

<p>First we need the URL of our ImageStream let get it by doing.</p>

<pre><code>$ oc get is

NAME       DOCKER REPO                      TAGS      UPDATED
cvr-node   172.30.1.1:5000/hello/cvr-node   latest    39 seconds ago
</code></pre>

<p>Next let define our Pod, I want to create a simple app so I&rsquo;m going to use the example Node.JS.</p>

<pre><code class="language-yml">apiVersion: v1
kind: Pod
metadata:
  name: node-example
  labels:
    app: myapp
spec:
  containers:
  - name: myapp-container
    image: 172.30.1.1:5000/hello/cvr-node  # Our imported image
    command: ['/bin/sh', '-c']
    args:
    - cd /app/node-openshift-master/;
      echo folder:$PWD;
      npm install;
      nodemon $(node -e &quot;console.log(require('./package.json').main)&quot;)


    volumeMounts:
    - mountPath: /app
      name: app-volume
    - mountPath: /.npm  
      name: npm-cache

    ports:
    - containerPort: 8080
  initContainers:
  - name: cloning  
    image: busybox
    command: ['/bin/sh', '-c']
    args:
    - cd /app/;
      wget -O src.zip https://github.com/cesarvr/node-openshift/archive/master.zip;
      unzip src.zip -d /app/;  
      rm src.zip;

    volumeMounts:
    - mountPath: /app
      name: app-volume
  volumes:
  - name: app-volume
    emptyDir: {}    
  - name: npm-cache
    emptyDir: {}   
</code></pre>

<p>We create the Pod</p>

<pre><code class="language-sh">oc create -f node.yml  
</code></pre>

<p>After some initialization, assuming that everything is fine we should our Pod running, next thing is to expose it.</p>

<pre><code class="language-sh">oc expose pod node-example
oc expose service node-example  
</code></pre>

<h3 id="demo">Demo</h3>

<script type="text/javascript" src="https://asciinema.org/a/IJURr9cdQZTX1Q5Ue8jr1S3Zc.js" id="asciicast-IJURr9cdQZTX1Q5Ue8jr1S3Zc" async></script>

</div>


  </div>
</section><footer class="footer">
  <div class="content has-text-centered">
    
    <p>
      Last modified September 03, 2018
      
      (commit 91445aa)
      
    </p>
    
    
    <p>
      
      
    </p>
    
  </div>
</footer>


</body>
</html>
